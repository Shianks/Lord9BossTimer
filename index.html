<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Respawn Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .timer-display {
            font-family: 'Courier New', monospace;
        }
        .flip {
            animation: flip 0.5s ease-in-out;
        }
        @keyframes flip {
            0%, 100% { transform: rotateX(0deg); }
            50% { transform: rotateX(90deg); }
        }
        .pulse {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .completed {
            background: linear-gradient(135deg, #4c1d95 0%, #2d3748 100%);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-yellow-400 mb-2">BOSS RESPAWN TIMER</h1>
            <p class="text-gray-400 mb-4">Automatically calculate boss respawn times in GMT+8</p>
            <div class="flex justify-center items-center">
                <span class="text-sm bg-gray-700 px-3 py-1 rounded-full">
                    <i class="fas fa-clock mr-1"></i> Current GMT+8: <span id="current-time">00:00:00</span>
                </span>
            </div>
        </header>

        <!-- Input Form -->
        <div class="bg-gray-800 rounded-lg p-6 mb-8 shadow-lg">
            <h2 class="text-xl font-semibold text-yellow-400 mb-4">Add Boss Timer</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div class="col-span-2">
                    <label for="boss-name" class="block text-sm font-medium mb-1 text-gray-300">BOSS NAME</label>
                    <input type="text" id="boss-name" placeholder="e.g., Venatus" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                <div class="col-span-1">
                    <label for="boss-level" class="block text-sm font-medium mb-1 text-gray-300">LEVEL</label>
                    <input type="number" id="boss-level" placeholder="Level" min="1" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                <div class="col-span-1">
                    <label for="boss-status" class="block text-sm font-medium mb-1 text-gray-300">STATUS</label>
                    <select id="boss-status" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                        <option value="estimated">Estimated</option>
                        <option value="confirmed">Confirmed</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div class="col-span-1">
                    <label for="respawn-hours" class="block text-sm font-medium mb-1 text-gray-300">RESPAWN HOURS</label>
                    <input type="number" id="respawn-hours" placeholder="Hours" min="0" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                <div class="col-span-1">
                    <label for="respawn-minutes" class="block text-sm font-medium mb-1 text-gray-300">RESPAWN MINUTES</label>
                    <input type="number" id="respawn-minutes" placeholder="Minutes" min="0" max="59" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                <div class="col-span-2">
                    <label for="kill-time" class="block text-sm font-medium mb-1 text-gray-300">KILL TIME (GMT+8)</label>
                    <div class="flex space-x-2">
                        <input type="datetime-local" id="kill-time" class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                        <button id="set-current-time" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded whitespace-nowrap">
                            <i class="fas fa-clock mr-1"></i> Now
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex space-x-2 justify-end">
                <button id="start-timer" class="px-6 py-2 bg-green-600 hover:bg-green-700 rounded">
                    <i class="fas fa-play mr-1"></i> Start Timer
                </button>
                <button id="reset-form" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded">
                    <i class="fas fa-redo mr-1"></i> Reset
                </button>
            </div>
        </div>

        <!-- Spawn Preview -->
        <div id="spawn-preview" class="bg-gray-800 rounded-lg p-4 mb-6 hidden">
            <h3 class="text-lg font-semibold text-yellow-400 mb-2">Next Spawn Time</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <span class="text-gray-400">Killed at:</span>
                    <span id="preview-kill-time" class="ml-2">-</span>
                </div>
                <div>
                    <span class="text-gray-400">Respawns at:</span>
                    <span id="preview-spawn-time" class="ml-2 text-green-400 font-semibold">-</span>
                </div>
            </div>
        </div>

        <!-- Active Timers -->
        <div id="timers-container" class="grid grid-cols-1 gap-4">
            <!-- Timer entries will be added here -->
        </div>

        <!-- Timer Template (Hidden) -->
        <div class="mt-8 p-6 bg-gray-800 rounded-lg shadow-lg hidden" id="sample-timer">
            <div class="flex flex-col md:flex-row md:items-center justify-between">
                <div class="mb-4 md:mb-0">
                    <h3 class="text-xl font-bold text-yellow-400" data-field="boss-name">Boss Name</h3>
                    <div class="flex flex-wrap gap-x-4 mt-1 text-sm text-gray-300">
                        <span data-field="boss-level">Lv. 0</span>
                        <span data-field="boss-status" class="px-2 py-1 rounded text-xs bg-gray-700"></span>
                    </div>
                </div>
                <div class="flex flex-col md:items-end">
                    <div class="timer-display text-3xl font-bold font-mono mb-1" data-field="countdown">00:00:00</div>
                    <div class="text-xs text-gray-400">
                        <span data-field="time-left" class="text-yellow-300">0h 0m left</span>
                    </div>
                </div>
            </div>

            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-700">
                <div>
                    <div class="text-sm text-gray-400 mb-1">Respawn Time:</div>
                    <div class="text-sm" data-field="respawn-time">-</div>
                </div>
                <div>
                    <div class="text-sm text-gray-400 mb-1">Killed At (GMT+8):</div>
                    <div class="text-sm" data-field="kill-time">-</div>
                </div>
            </div>

            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-700">
                <div>
                    <div class="text-sm text-gray-400 mb-1">Next Spawn (GMT+8):</div>
                    <div class="text-lg font-semibold text-green-400" data-field="next-spawn">-</div>
                </div>
                <div class="flex items-end justify-end">
                    <button class="boss-died-btn px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded">
                        <i class="fas fa-skull mr-1"></i> Boss Died Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update current time (GMT+8)
        function updateCurrentTime() {
            const now = new Date();
            // Set to GMT+8
            const gmt8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            document.getElementById('current-time').textContent =
                gmt8Time.toLocaleTimeString('en-US', { hour12: false }) +
                ' (' + gmt8Time.toLocaleDateString() + ')';
        }
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        // Set current time as kill time
        document.getElementById('set-current-time').addEventListener('click', function() {
            const now = new Date();
            // Convert to local datetime-local format (YYYY-MM-DDTHH:MM)
            const localDateTime = now.toISOString().slice(0, 16);
            document.getElementById('kill-time').value = localDateTime;
            updateSpawnPreview();
        });

        // Update spawn preview when values change
        document.getElementById('kill-time').addEventListener('change', updateSpawnPreview);
        document.getElementById('respawn-hours').addEventListener('input', updateSpawnPreview);
        document.getElementById('respawn-minutes').addEventListener('input', updateSpawnPreview);

        function updateSpawnPreview() {
            const killTimeInput = document.getElementById('kill-time').value;
            const respawnHours = parseInt(document.getElementById('respawn-hours').value) || 0;
            const respawnMinutes = parseInt(document.getElementById('respawn-minutes').value) || 0;

            if (killTimeInput && (respawnHours > 0 || respawnMinutes > 0)) {
                const killTime = new Date(killTimeInput);
                const totalMilliseconds = (respawnHours * 3600 + respawnMinutes * 60) * 1000;
                const spawnTime = new Date(killTime.getTime() + totalMilliseconds);

                document.getElementById('preview-kill-time').textContent = formatDateTime(killTime);
                document.getElementById('preview-spawn-time').textContent = formatDateTime(spawnTime);
                document.getElementById('spawn-preview').classList.remove('hidden');
            } else {
                document.getElementById('spawn-preview').classList.add('hidden');
            }
        }

        // Timer functionality
        let activeTimers = [];

        const LOCAL_STORAGE_KEY = 'bossTimers'; // Key for local storage

        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function formatShortTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            return `${hrs}h ${mins}m`;
        }

        function formatDateTime(date) {
            return date.toLocaleString('en-US', {
                hour12: false,
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            }).replace(',', '');
        }

        function saveTimers() {
            // We only want to save the 'bossData' part of each timer
            const timersToSave = activeTimers.map(timer => ({
                name: timer.bossData.name,
                level: timer.bossData.level,
                status: timer.bossData.status,
                hours: timer.bossData.hours,
                minutes: timer.bossData.minutes,
                // Convert Date object to ISO string for storage
                killTime: timer.bossData.killTime.toISOString()
            }));
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(timersToSave));
        }

        function loadTimers() {
            const savedTimers = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (savedTimers) {
                const parsedTimers = JSON.parse(savedTimers);
                parsedTimers.forEach(bossData => {
                    // Convert killTime string back to Date object
                    bossData.killTime = new Date(bossData.killTime);
                    createTimer(bossData, true); // Pass true to indicate it's loading from storage
                });
            }
        }

        function updateTimers() {
            const now = Date.now();
            activeTimers.forEach(timer => {
                if (timer.active) {
                    const remaining = Math.floor((timer.endTime - now) / 1000);
                    if (remaining <= 0) {
                        timer.active = false;
                        timer.countdownEl.textContent = "SPAWNED!";
                        timer.countdownEl.classList.add('text-red-500', 'pulse');
                        timer.timeLeftEl.textContent = "BOSS IS UP!";
                        timer.timerElement.classList.add('completed');
                    } else {
                        timer.countdownEl.textContent = formatTime(remaining);
                        timer.timeLeftEl.textContent = formatShortTime(remaining) + ' until spawn';
                    }
                }
            });
        }

        // Modified createTimer to handle loading from storage
        function createTimer(bossData, isLoading = false) {
            const sampleTimer = document.getElementById('sample-timer');
            const newTimer = sampleTimer.cloneNode(true);
            newTimer.id = '';
            newTimer.classList.remove('hidden');

            // Set boss data
            newTimer.querySelector('[data-field="boss-name"]').textContent = bossData.name || 'Unknown Boss';
            newTimer.querySelector('[data-field="boss-level"]').textContent = `Lv. ${bossData.level || '?'}`;

            // Set status badge
            const statusEl = newTimer.querySelector('[data-field="boss-status"]');
            statusEl.textContent = bossData.status === 'confirmed' ? 'Confirmed' : 'Estimated';
            statusEl.className = `px-2 py-1 rounded text-xs ${bossData.status === 'confirmed' ? 'bg-green-700' : 'bg-yellow-700'}`;

            // Set respawn time
            newTimer.querySelector('[data-field="respawn-time"]').textContent =
                `${bossData.hours}h ${bossData.minutes}m`;

            // Calculate times
            // Ensure killTime is a Date object, especially when loading from local storage
            const killTime = new Date(bossData.killTime);
            const totalMilliseconds = (bossData.hours * 3600 + bossData.minutes * 60) * 1000;
            const spawnTime = new Date(killTime.getTime() + totalMilliseconds);

            // Set time displays
            newTimer.querySelector('[data-field="kill-time"]').textContent = formatDateTime(killTime);
            newTimer.querySelector('[data-field="next-spawn"]').textContent = formatDateTime(spawnTime);

            // Get elements for countdown
            const countdownEl = newTimer.querySelector('[data-field="countdown"]');
            const timeLeftEl = newTimer.querySelector('[data-field="time-left"]');

            // Add to DOM
            document.getElementById('timers-container').prepend(newTimer);

            // Store timer data
            const timerObj = {
                bossData,
                countdownEl,
                timeLeftEl,
                timerElement: newTimer,
                endTime: spawnTime.getTime(),
                totalMilliseconds: totalMilliseconds,
                active: true
            };

            activeTimers.push(timerObj);

            // Set up boss died button
            newTimer.querySelector('.boss-died-btn').addEventListener('click', function() {
                if (confirm('Reset timer with current time as new kill time?')) {
                    const newKillTime = new Date();
                    const newSpawnTime = new Date(newKillTime.getTime() + timerObj.totalMilliseconds);

                    // Update bossData killTime
                    timerObj.bossData.killTime = newKillTime;

                    // Update displays
                    newTimer.querySelector('[data-field="kill-time"]').textContent = formatDateTime(newKillTime);
                    newTimer.querySelector('[data-field="next-spawn"]').textContent = formatDateTime(newSpawnTime);

                    // Reset timer
                    timerObj.endTime = newSpawnTime.getTime();
                    timerObj.active = true;
                    timerObj.timerElement.classList.remove('completed');
                    timerObj.countdownEl.classList.remove('text-red-500', 'pulse');
                    timerObj.countdownEl.classList.add('flip');
                    setTimeout(() => timerObj.countdownEl.classList.remove('flip'), 500);

                    saveTimers(); // Save after updating a timer
                }
            });

            // Initial animation only for newly created timers, not when loading from storage
            if (!isLoading) {
                countdownEl.classList.add('flip');
                setTimeout(() => countdownEl.classList.remove('flip'), 500);
                saveTimers(); // Save after creating a new timer
            }
        }

        // Start timer button
        document.getElementById('start-timer').addEventListener('click', function() {
            const bossName = document.getElementById('boss-name').value.trim() || 'Unknown Boss';
            const bossLevel = document.getElementById('boss-level').value;
            const bossStatus = document.getElementById('boss-status').value;
            const respawnHours = parseInt(document.getElementById('respawn-hours').value) || 0;
            const respawnMinutes = parseInt(document.getElementById('respawn-minutes').value) || 0;
            const killTimeInput = document.getElementById('kill-time').value;

            if (!killTimeInput) {
                alert('Please enter the kill time');
                return;
            }

            if (respawnHours <= 0 && respawnMinutes <= 0) {
                alert('Please enter a valid respawn time');
                return;
            }

            // Convert kill time to Date object
            const killTime = new Date(killTimeInput);

            createTimer({
                name: bossName,
                level: bossLevel,
                status: bossStatus,
                hours: respawnHours,
                minutes: respawnMinutes,
                killTime: killTime
            });

            // Optionally reset form after starting a timer
            document.getElementById('reset-form').click();
        });

        // Reset form button
        document.getElementById('reset-form').addEventListener('click', function() {
            document.getElementById('boss-name').value = '';
            document.getElementById('boss-level').value = '';
            document.getElementById('respawn-hours').value = '';
            document.getElementById('respawn-minutes').value = '';
            document.getElementById('kill-time').value = '';
            document.getElementById('boss-status').value = 'estimated';
            document.getElementById('spawn-preview').classList.add('hidden');
        });

        // Call loadTimers when the page loads
        window.addEventListener('load', loadTimers);

        // Update all timers every second
        setInterval(updateTimers, 1000);
    </script>
</body>
</html>